{% extends "base.html" %}
{% block title %}{{ t('menu.dashboard') }}{% endblock %}

{% block body %}



<main class="container mb-5">
  <!-- <button class="btn btn-outline-secondary mb-3" onclick="history.back()">‚Üê –ù–∞–∑–∞–¥</button> -->

  {% if role == 'student' %}
  <h2>{{ t('dashboard.welcome') }}, {{ login }}!</h2>

    <div class="calories alert alert-info">{{ t('dashboard.remaining') }}: {{ calories }} {{ t('grams') }}</div>
    <div class="bju mb-3">
      <div>{{ t('food.protein') }}: {{ protein }} {{ t('grams') }}</div>
      <div>{{ t('food.fat') }}: {{ fat }} {{ t('grams') }}</div>
      <div>{{ t('food.carbs') }}: {{ carbs }} {{ t('grams') }}</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
    <div class="btn-group mb-3">
  <a href="{{ url_for('eat') }}" class="btn btn-success">‚ûï {{ t('food.add_food') }}</a>
  <button id="toggleEdit" class="btn btn-outline-primary">‚öô {{ t('dashboard.nutrition_info') }}</button>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É—á–∏—Ç–µ–ª—è -->
    {% if is_teacher %}
    <div class="mt-2 mb-3">
  <hr>
  <h4>{{ t('dashboard.teacher_panel') }}</h4>
      <div class="btn-group">
        <a href="#" class="btn btn-primary">ÔøΩ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Å–∞</a>
      </div>
    </div>
    {% endif %}

    <div class="edit-section mb-3" id="editSection" style="display:none;">
      <form method="POST" action="{{ url_for('update_calories') }}" class="row g-2">
        <div class="col-md-3">
          <label class="form-label">{{ t('food.calories') }}:</label>
          <input type="number" class="form-control" name="calories" min="0" value="{{ calories }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">{{ t('food.protein') }} ({{ t('grams') }}):</label>
          <input type="number" class="form-control" name="protein" min="0" step="0.1" value="{{ protein }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">{{ t('food.fat') }} ({{ t('grams') }}):</label>
          <input type="number" class="form-control" name="fat" min="0" step="0.1" value="{{ fat }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">{{ t('food.carbs') }} ({{ t('grams') }}):</label>
          <input type="number" class="form-control" name="carbs" min="0" step="0.1" value="{{ carbs }}">
        </div>
        <div class="col-12 mt-2">
          <button type="submit" class="btn btn-primary">{{ t('actions.save') }}</button>
        </div>
      </form>
    </div>

    <h3>–í—ã —É–∂–µ —Å—ä–µ–ª–∏:</h3>
    <ul class="list-group">
      {% for item in eaten %}
        <li class="list-group-item">{{ item }}</li>
      {% endfor %}
    </ul>

  {% elif role == 'parent' %}
    <h2>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ login }}!</h2>
    
    <div class="mt-3 mb-3 d-flex gap-2">
      <a href="{{ url_for('parent_add_child') }}" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞</a>
      <a href="{{ url_for('parent_children') }}" class="btn btn-outline-primary">–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π</a>
    </div>

    <h3 class="mt-3">–ú–æ–∏ –¥–µ—Ç–∏</h3>
    <div class="row g-3">
      {% for child in children %}
        {% set sum = child_summaries.get(child.id) %}
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">{{ child.name or child.login }}</h5>
              <p class="card-text">–û—Å—Ç–∞—Ç–æ–∫ –∫–∞–ª–æ—Ä–∏–π: {{ sum.remaining_cal }} –∫–∫–∞–ª</p>
              <p class="card-text small">–ë–µ–ª–∫–∏: {{ sum.remaining_prot }} –≥ ¬∑ –ñ–∏—Ä—ã: {{ sum.remaining_fat }} –≥ ¬∑ –£–≥–ª–µ–≤–æ–¥—ã: {{ sum.remaining_carbs }} –≥</p>
              <p class="card-text"><strong>–°—ä–µ–¥–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è:</strong> {{ sum.sum_cal }} –∫–∫–∞–ª</p>
              <details>
                <summary class="small">–ü–æ–∫–∞–∑–∞—Ç—å —Å—ä–µ–¥–µ–Ω–Ω—ã–µ –±–ª—é–¥–∞</summary>
                <ul class="list-group list-group-flush mt-2">
                  {% for log in child_logs.get(child.id, []) %}
                    <li class="list-group-item small">{{ log.name }} ‚Äî {{ log.calories }} –∫–∫–∞–ª</li>
                  {% endfor %}
                </ul>
              </details>
              <div class="mt-3">
                <a href="{{ url_for('child_report', student_id=child.id) }}" 
                   class="btn btn-sm btn-outline-primary w-100" 
                   target="_blank" rel="noopener noreferrer">
                  üìä –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á—ë—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  {% elif role == 'cook' %}
    <h2>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ get_role_display('cook') }} {{ login }}!</h2>
    <div class="info mb-3">–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —à–∫–æ–ª—å–Ω—ã–º –º–µ–Ω—é.</div>
    <a href="{{ url_for('cook_menu') }}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–µ–Ω—é {{ get_role_display('cook') }}</a>

  {% else %}
    <h2>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å</h2>
  {% endif %}
</main>


<script>
  document.getElementById("toggleEdit").addEventListener("click", function() {
    const editSection = document.getElementById("editSection");
    if(editSection.style.display === "none" || editSection.style.display === "") {
      editSection.style.display = "block";
      this.textContent = "‚úñ –ó–∞–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏";
    } else {
      editSection.style.display = "none";
      this.textContent = "‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–ë–ñ–£";
    }
  });
</script>

{% endblock %}
