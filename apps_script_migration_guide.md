# Миграция на Google Apps Script

## Обзор
Это руководство по миграции Flask-приложения на Google Apps Script для работы в Google Таблицах.

## Шаги миграции

### 1. Создание Google Apps Script проекта
1. Откройте Google Таблицы (sheets.google.com)
2. Создайте новую таблицу
3. Перейдите в "Расширения" > "Apps Script"
4. Скопируйте содержимое `apps_script.gs` в редактор Apps Script
5. Добавьте HTML-файл: В Apps Script редакторе, "Файл" > "Новый" > "HTML-файл", назовите `base_new` и вставьте содержимое `base_new.html`

### 2. Включение API
1. В Apps Script редакторе, "Ресурсы" > "Дополнительные сервисы"
2. Найдите и включите "Google Cloud Vision API"
3. Сохраните проект

### 3. Настройка веб-приложения
1. В Apps Script редакторе, "Опубликовать" > "Развернуть как веб-приложение"
2. Выберите версию, установите права доступа (для всех, включая анонимных)
3. Получите URL веб-приложения

### 4. Инициализация таблиц
1. В Apps Script редакторе, запустите функцию `initializeSheets`
2. Это создаст все необходимые листы в таблице

### 5. Структура данных
- **Parents**: Родители
- **Students**: Ученики
- **Cooks**: Повара
- **Eat**: Еда
- **EatLog**: Логи питания
- **Cities**: Города
- **Schools**: Школы
- **Grades**: Классы
- **Admins**: Администраторы
- **Packs**: Наборы еды
- **PackItems**: Элементы наборов

## Функции Apps Script

### Основные функции
- `initializeSheets()`: Инициализация заголовков таблиц
- `createParent()`, `getParent()`: Работа с родителями
- `createStudent()`, `getStudent()`: Работа с учениками
- `createEat()`, `getEatById()`: Работа с едой
- `createEatLog()`: Создание логов питания
- `analyzeFoodImage()`: Анализ фото через Vision API

### Веб-функции
- `doGet()`: Возвращает HTML интерфейс
- `doPost()`: Обрабатывает POST-запросы
- `handleLogin()`: Обработка входа
- `handleRegister()`: Обработка регистрации

## Фронтенд
HTML-файл `base_new.html` содержит:
- Адаптивный интерфейс на Bootstrap
- JavaScript для навигации и взаимодействия с Apps Script
- Формы входа и регистрации
- Интерфейс анализа фото

## Анализ фото
Использует Google Vision API для распознавания объектов на фото еды. Возвращает метки с вероятностями.

## Безопасность
- Хэширование паролей с SHA-256
- Проверка ролей пользователей
- Защита от XSS через CSP

## Дальнейшие шаги
1. Протестируйте веб-приложение
2. Добавьте дополнительные функции по мере необходимости
3. Настройте триггеры для автоматических задач
4. Рассмотрите добавление аутентификации через Google аккаунты